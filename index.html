<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Trail Test Map</title>
  <style>
    html, body, #map { margin:0; padding:0; width:100%; height:100%; }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAIfCWstMFLCiR9VJMS6lePKoytUgy1qPY"></script>
</head>
<body>
  <div id="map"></div>
  <script>
    const ENDPOINT = 'https://script.google.com/macros/s/AKfycbzUuSXVnDgNVmR3lVH9X2ovAeahJnSWCe6oQXzxPGEefBCq-AL0pMMb853zApv7KNDa/exec';
    const CENTER_FALLBACK = { lat: 36.3526, lng: -94.2755 };

    let map, trailPolyline;

    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: CENTER_FALLBACK,
        zoom: 14,
        mapTypeId: 'hybrid'
      });
      fetchTrail();
    }

    async function fetchTrail() {
      try {
        const now = Date.now();
        const since = new Date(now - 2 * 60 * 60 * 1000).toISOString();
        const res = await fetch(`${ENDPOINT}?json=true&since=${encodeURIComponent(since)}&t=${now}`);
        const data = await res.json();
        if (!data.length) return;

        const trailCoords = data.map(pt => ({ lat: pt.latitude, lng: pt.longitude }));

        trailPolyline = new google.maps.Polyline({
          path: trailCoords,
          geodesic: true,
          strokeColor: '#00F',
          strokeOpacity: 0.7,
          strokeWeight: 4
        });

        trailPolyline.setMap(map);
        map.setCenter(trailCoords[trailCoords.length - 1]);
      } catch (err) {
        console.error('Trail fetch error', err);
      }
    }

    window.onload = initMap;
  </script>
</body>
</html>
